(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Pledge"],{"0317":function(t,e,n){t.exports=n.p+"img/lp.d8e777b2.svg"},9565:function(t,e,n){},b1cc:function(t,e,n){"use strict";n("9565")},b296:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pledge"},[a("div",{staticClass:"form"},[a("div",{staticClass:"container"},[a("div",{staticClass:"tokens"},[a("img",{attrs:{src:n("0317")}}),a("div",[a("span",[t._v("PIN-CS/LP")]),a("span",[t._v(t._s(t.lpBalance.toFixed(2)))])])]),a("div",{staticClass:"title"},[t._v(t._s(t.$t("pledge.text1")))]),a("div",{staticClass:"input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.pledgeNum,expression:"pledgeNum"}],attrs:{type:"number",placeholder:t.title},domProps:{value:t.pledgeNum},on:{input:[function(e){e.target.composing||(t.pledgeNum=e.target.value)},t.input]}}),a("button",{attrs:{disabled:0==t.lpBalance},on:{click:t.allin}},[t._v(t._s(t.$t("pledge.text3")))])]),a("div",{staticClass:"get-power"},[a("span",[t._v(t._s(t.$t("pledge.text4")))]),a("span",[t._v(t._s(t.getPower))])]),a("span",{on:{click:t.getLP}},[t._v(t._s(t.$t("pledge.text5")))]),a("button",{attrs:{disabled:0==t.lpBalance},on:{click:t.transition}},[t._v(t._s(t.isApprove?t.$t("pledge.text12"):t.$t("pledge.text13")))])])]),a("div",{staticClass:"record"},[a("div",{staticClass:"title"},[t._v(t._s(t.$t("pledge.text8")))]),a("div",{staticClass:"list-container"},t._l(t.records,(function(e){return a("div",{key:e,staticClass:"list-item"},[a("div",{staticClass:"pair"},[t._m(0,!0),a("span",[t._v(t._s(e.time))])]),a("div",{staticClass:"amount"},[a("span",[t._v(t._s(t.$t("pledge.text9")))]),a("span",[t._v(t._s(e.amount))])])])})),0)])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("img",{attrs:{src:n("0317")}}),a("span",[t._v("PIN-CS/LP")])])}],i=(n("99af"),n("fb6a"),n("a9e3"),n("b680"),n("96cf"),n("1da1")),o={data:function(){return{records:[],lpBalance:0,pledgeNum:"",allowance:0,isApprove:!0,gainPower:0,inputing:!1,getPower:0,title:this.$t("pledge.text2"),isStart:!1}},created:function(){this.$contracts&&this.init()},methods:{getLP:function(){location.href="https://pinswap.github.io/#/join-fund-pool"},init:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=new t.$web3.BatchRequest,n.add(t.$contracts.Pledge.methods.isStart().call.request({from:t.$address})),n.add(t.$contracts.Pair.methods.balanceOf(t.$address).call.request({from:t.$address})),n.add(t.$contracts.Pair.methods.allowance(t.$address,t.$contracts.Pledge._address).call.request({from:t.$address})),n.add(t.$contracts.Pledge.methods.getMinerInfo(0).call.request({from:t.$address})),n.requestManager.sendBatch(n.requests,(function(e,n){if(!e){var a=n[3].result.decode([{name:"pledgeLp",type:"uint256"},{name:"gainPower",type:"uint256"}]),s=a.gainPower;t.isStart=("string"===typeof n[0]?n[0]:n[0].result).decode(["bool"]),t.lpBalance=n[1].result.decode(["uint256"]).fromWei(),t.allowance=n[2].result.decode(["uint256"]).fromWei(),t.gainPower=s}})),a=[],t.$contracts.Pledge.events.DoPledge({fromBlock:0,filter:{owner:t.$address}}).on("data",(function(e){var n=e.returnValues,s=n.time,i=n.amount;a.unshift({amount:i.fromWei(),time:t.formatDate(s)})})),t.records=a;case 9:case"end":return e.stop()}}),e)})))()},allin:function(){this.pledgeNum=this.lpBalance,this.input()},input:function(){var t=this;if(Number(this.pledgeNum)<=0)return this.getPower=0,!1;if(this.inputing)return this.isApprove=Number(this.allowance)>=Number(this.pledgeNum),!1;this.inputing=!0,this.isApprove=Number(this.allowance)>=Number(this.pledgeNum),console.log(this.pledgeNum);var e=setTimeout((function(){if(Number(t.pledgeNum)<=0)return t.getPower=0,t.inputing=!1,clearTimeout(e),!1;t.$contracts.Pledge.methods.predictPower(0,t.pledgeNum.toWei(),!0).call({from:t.$address},(function(n,a){n?console.log(n):(a.toBN().gt(t.gainPower)?t.getPower=a.toBN().minus(t.gainPower).toFixed():t.getPower="-".concat(t.gainPower.toBN().minus(a).toFixed()),t.inputing=!1,clearTimeout(e))}))}),1e3)},approve:function(){var t=this,e=this.$contracts.Pair.methods.approve(this.$contracts.Pledge._address,(10*Number(this.pledgeNum)).toWei());e.call({from:this.$address},(function(n,a){n||e.send({from:t.$address}).on("transactionHash",(function(e){vant.Toast.loading({message:t.$t("transaction.text6"),forbidClick:!0,duration:0,loadingType:"spinner"})})).on("receipt",(function(e){vant.Toast.clear(),t.init(),t.isApprove=!0,vant.Toast.success(t.$t("pledge.text10"))})).on("error",(function(e){vant.Toast.clear(),vant.Toast.fail(t.$t("transaction.text13"))}))}))},transition:function(){Number(this.gainPower)<0?vant.Dialog.confirm({message:this.$t("pledge.text14",{number:this.gainPower.slice(1)}),confirmButtonText:this.$t("pledge.text15"),cancelButtonText:this.$t("pledge.text16"),confirmButtonColor:"#3C94FF",cancelButtonColor:"#ee0a24"}).then(this.doPledge).catch((function(){})):this.doPledge()},doPledge:function(){var t=this;if(!this.isStart)return vant.Toast.fail(this.$t("pledge.text17"));if(Number(this.pledgeNum)<.1)return vant.Toast.fail(this.$t("pledge.text18"));if(Number(this.pledgeNum)>Number(this.lpBalance))return vant.Toast.fail(this.$t("boardLockout.text11"));if(!this.isApprove)return this.approve();var e=this.$contracts.Pledge.methods.doPledge(0,this.pledgeNum.toWei());e.call({from:this.$address},(function(n,a){n?console.log(n):e.send({from:t.$address}).on("transactionHash",(function(e){vant.Toast.loading({message:t.$t("transaction.text7"),forbidClick:!0,duration:0,loadingType:"spinner"})})).on("receipt",(function(e){vant.Toast.clear(),t.init(),t.pledgeNum="",t.getPower=0,vant.Toast.success(t.$t("pledge.text11"))})).on("error",(function(e){vant.Toast.clear(),vant.Toast.fail(t.$t("transaction.text13"))}))}))},formatDate:function(t){var e=new Date(1e3*Number(t)),n=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),i=e.getHours(),o=e.getMinutes();return"".concat(n,"/").concat(a,"/").concat(s," ").concat(i,":").concat(o)}}},r=o,c=r,l=(n("b1cc"),n("2877")),d=Object(l["a"])(c,a,s,!1,null,"338c018a",null);e["default"]=d.exports}}]);